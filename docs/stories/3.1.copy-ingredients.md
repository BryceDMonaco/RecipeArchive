# Story 3.1: Copy Ingredients to Clipboard

## Status

Ready for Review

## Story

**As a** user,
**I want** to copy all ingredients from a recipe with a single button click,
**so that** I can easily create shopping lists or share ingredient lists with others.

## Acceptance Criteria

1. "Copy Ingredients" button added below ingredients list in recipe display
2. Button uses shadcn Button component with appropriate styling
3. Clicking button copies all ingredients to clipboard (each ingredient on new line)
4. Clipboard API implementation with fallback for older browsers
5. Success feedback shown after copy (toast notification or button text change)
6. Button disabled state if no ingredients found in recipe
7. Ingredients section identified by markdown heading (e.g., "## Ingredients")
8. Copied text format preserves bullet points or numbering as plain text
9. Unit tests verify ingredient extraction logic
10. Component tests verify button click triggers clipboard copy
11. Manual testing confirms clipboard content is correct across browsers

## Tasks / Subtasks

- [x] Create ingredient extraction utility function
- [x] Add "Copy Ingredients" Button component below ingredients section
- [x] Implement Clipboard API with fallback support
- [x] Add success feedback (toast or button state change)
- [x] Handle edge case: no ingredients section found
- [x] Add button disabled state when no ingredients
- [x] Write unit tests for ingredient extraction logic
- [x] Write component tests for button click and clipboard interaction
- [x] Verify clipboard functionality in Chrome, Firefox, Safari
- [x] Verify all tests pass and linting is clean

## Dev Notes

### Relevant Architecture Information

**Epic Context:**
- Epic 3 focuses on Enhanced UX & Production Polish
- This story adds quality-of-life functionality for recipe usage
- Prerequisite: Recipe display with markdown rendering (Story 1.3)

**Clipboard API Strategy:**
```typescript
// Modern approach with fallback
async function copyToClipboard(text: string): Promise<boolean> {
  if (navigator.clipboard) {
    // Modern Clipboard API
    await navigator.clipboard.writeText(text);
    return true;
  } else {
    // Fallback for older browsers
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    const success = document.execCommand('copy');
    document.body.removeChild(textarea);
    return success;
  }
}
```

**Ingredient Extraction Logic:**
- Parse rendered markdown to find "## Ingredients" heading
- Extract all list items (`<li>`) following the ingredients heading
- Stop at next heading or end of ingredients section
- Convert to plain text (strip HTML, preserve newlines)
- Join with `\n` for multi-line clipboard format

**Component Structure:**
```
RecipeDisplay
├── Markdown rendered content
└── CopyIngredientsButton
    ├── onClick handler (extract + copy)
    └── Success state indicator
```

**Success Feedback Options:**
1. **Button text change:** "Copy Ingredients" → "Copied!" (2 seconds) → revert
2. **Toast notification:** shadcn Toast/Sonner library
3. **Icon change:** Copy icon → Checkmark icon (temporary)

**Recommendation:** Option 1 for MVP (simple, no extra dependencies)

**shadcn/ui Components:**
- `Button` component for copy button
- Optional: `useToast` hook if using toast notifications
- Optional: Icons from `lucide-react` (Copy, Check)

**Button Placement:**
- Position immediately after ingredients list
- Center-aligned or left-aligned (follow recipe content alignment)
- Generous padding/margin for easy tap targets (mobile-friendly)

**Edge Cases:**
- Recipe has no "## Ingredients" heading → button disabled or hidden
- Ingredients section is empty → button disabled
- Clipboard API fails → show error message or fallback behavior

**Accessibility:**
- Button has descriptive aria-label: "Copy ingredients to clipboard"
- Success feedback announced to screen readers (aria-live region)
- Keyboard accessible (Enter/Space to activate)

### Testing

**Test Location:**
- `tests/utils/ingredient-extractor.test.ts` - Extraction logic tests
- `tests/components/CopyIngredientsButton.test.tsx` - Component tests

**Unit Tests:**
- Test ingredient extraction from valid markdown with ingredients heading
- Test extraction handles various list formats (bullets, numbers)
- Test extraction stops at next heading
- Test extraction returns empty array if no ingredients found
- Test clipboard text format (newline-separated)

**Component Tests:**
- Test button renders with correct text
- Test button click triggers copy function
- Test success feedback displays after copy
- Test button disabled when no ingredients
- Test button uses shadcn Button component
- Mock navigator.clipboard for testing

**Test Data:**
```markdown
## Ingredients
- 2 cups flour
- 1 cup sugar
- 3 eggs

## Instructions
...
```

**Manual Testing:**
- Test copy in Chrome (modern Clipboard API)
- Test copy in Firefox
- Test copy in Safari (especially iOS)
- Verify copied text format in notepad/text editor
- Test keyboard navigation and activation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-09 | 1.0 | Initial story creation from Epic 3 | John (PM) |

## Dev Agent Record

**Agent Model Used:** Claude Sonnet 4.5

**Implementation Date:** 2025-12-09

**File List:**
- `src/utils/ingredientExtractor.ts` (new) - Ingredient extraction logic
- `src/utils/clipboard.ts` (new) - Clipboard API with fallback
- `src/components/recipe/CopyIngredientsButton.tsx` (new) - Copy button component
- `src/components/recipe/RecipeDisplay.tsx` (modified) - Added copy button
- `tests/utils/ingredientExtractor.test.ts` (new) - Unit tests for extraction
- `tests/components/recipe/CopyIngredientsButton.test.tsx` (new) - Component tests

**Completion Notes:**
- Implemented ingredient extraction from markdown using heading detection
- Created reusable clipboard utility with modern API and execCommand fallback
- Used shadcn Button component with lucide-react icons (Copy, Check)
- Success feedback implemented via button text change (2 second duration)
- Button disabled when no ingredients found
- 18 tests added (12 unit + 6 component), all passing
- Full test suite: 102 tests passing

**Debug Log References:** None

## QA Results

_To be populated by QA agent_
