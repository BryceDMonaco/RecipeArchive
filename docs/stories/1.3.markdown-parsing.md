# Story 1.3: Markdown Recipe Parsing and Display

## Status

Ready for Review

## Story

**As a** user,
**I want** to view a recipe with properly formatted markdown content,
**so that** I can read recipes in a clear, readable format.

## Acceptance Criteria

1. `remark` and `react-markdown` libraries installed and configured
2. Recipe data structure defined with TypeScript interface (title, tags, content)
3. Frontmatter parsing implemented to extract title and tags from YAML
4. RecipeDisplay component created to render markdown content
5. Sample recipe markdown file created in `/recipes` directory
6. Application loads and displays the sample recipe in the main content area
7. Markdown headings, lists, bold/italic text render correctly
8. Unit tests verify frontmatter parsing extracts title and tags correctly
9. Component tests verify RecipeDisplay renders markdown content

## Tasks / Subtasks

- [x] Install markdown processing libraries (AC: 1)
  - [x] Install `react-markdown` and `remark`
  - [x] Install `gray-matter` for frontmatter parsing
  - [x] Install `remark-gfm` for GitHub Flavored Markdown support

- [x] Define TypeScript interfaces for recipes (AC: 2)
  - [x] Create `src/types/recipe.ts`
  - [x] Define `Recipe` interface (slug, title, tags, content, filePath)
  - [x] Define `RecipeMetadata` interface (Recipe without content)
  - [x] Define `RecipeFrontmatter` interface (title, tags)
  - [x] Export all interfaces

- [x] Implement frontmatter parsing service (AC: 3, 8)
  - [x] Create `src/services/recipeParser.ts`
  - [x] Implement `parseRecipeFile(content: string)` function
  - [x] Extract frontmatter with gray-matter
  - [x] Parse tags (support both string and array formats)
  - [x] Handle missing/malformed frontmatter gracefully
  - [x] Write unit tests for parseRecipeFile

- [x] Create RecipeDisplay component (AC: 4, 6, 7)
  - [x] Create `src/components/recipe/RecipeDisplay.tsx`
  - [x] Accept recipe content as prop
  - [x] Use react-markdown to render content
  - [x] Apply shadcn typography classes for styling
  - [x] Configure remark-gfm plugin
  - [x] Set max-width 800px for readability
  - [x] Add proper heading hierarchy (H1 for title, H2 for sections)

- [x] Create sample recipe file (AC: 5)
  - [x] Create `/recipes` directory
  - [x] Create `recipes/chocolate-chip-cookies.md`
  - [x] Add YAML frontmatter with title and tags
  - [x] Add "## Ingredients" section with bullet list
  - [x] Add "## Instructions" section with numbered list
  - [x] Follow kebab-case naming convention

- [x] Integrate RecipeDisplay into application (AC: 6)
  - [x] Update MainContent to display RecipeDisplay
  - [x] Load sample recipe content in App.tsx
  - [x] Parse recipe with recipeParser service
  - [x] Pass parsed content to RecipeDisplay
  - [x] Verify recipe displays correctly in browser

- [x] Write component tests (AC: 9)
  - [x] Create `tests/components/recipe/RecipeDisplay.test.tsx`
  - [x] Test: Renders markdown headings
  - [x] Test: Renders bulleted lists
  - [x] Test: Renders numbered lists
  - [x] Test: Renders bold/italic text
  - [x] Test: Applies correct typography styles

- [x] Write service unit tests (AC: 8)
  - [x] Create `tests/services/recipeParser.test.ts`
  - [x] Test: Extracts title from frontmatter
  - [x] Test: Extracts tags array from frontmatter
  - [x] Test: Handles comma-separated tags string
  - [x] Test: Handles missing frontmatter (fallback to filename)
  - [x] Test: Handles malformed YAML gracefully

## Dev Notes

### Relevant Architecture Information

**Tech Stack:**
- **Markdown Processing:** remark + react-markdown
- **Frontmatter Parsing:** gray-matter
- **Markdown Extensions:** remark-gfm (GitHub Flavored Markdown)

**Data Models (from Architecture):**

```typescript
// src/types/recipe.ts
interface Recipe {
  slug: string;
  title: string;
  tags: string[];
  content: string;
  filePath: string;
}

interface RecipeMetadata {
  slug: string;
  title: string;
  tags: string[];
  filePath: string;
  // content excluded from metadata
}

interface RecipeFrontmatter {
  title: string;
  tags: string | string[]; // Support both formats
}
```

**Recipe File Format (from Architecture):**

```yaml
---
title: Chocolate Chip Cookies
tags: dessert, baking, quick, vegetarian
---

## Ingredients

- 2 cups all-purpose flour
- 1 tsp baking soda
- 1 cup butter, softened
- 3/4 cup granulated sugar
- 2 eggs
- 2 cups chocolate chips

## Instructions

1. Preheat oven to 375°F (190°C).
2. Mix dry ingredients in a bowl.
3. Cream butter and sugar in separate bowl.
4. Combine wet and dry ingredients.
5. Fold in chocolate chips.
6. Bake for 10-12 minutes until golden.
```

**File Naming Convention:**
- kebab-case: `chocolate-chip-cookies.md`
- Slug derived from filename without extension

**Component Structure:**

```typescript
// src/components/recipe/RecipeDisplay.tsx
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import type { Recipe } from '@/types/recipe';

interface RecipeDisplayProps {
  recipe: Recipe;
}

export function RecipeDisplay({ recipe }: RecipeDisplayProps) {
  return (
    <article className="max-w-3xl mx-auto px-8">
      <h1 className="text-4xl font-bold mb-6">{recipe.title}</h1>
      <ReactMarkdown
        remarkPlugins={[remarkGfm]}
        className="prose prose-zinc"
      >
        {recipe.content}
      </ReactMarkdown>
    </article>
  );
}
```

**Parser Service:**

```typescript
// src/services/recipeParser.ts
import matter from 'gray-matter';
import type { Recipe, RecipeFrontmatter } from '@/types/recipe';

export function parseRecipeFile(
  fileContent: string,
  filePath: string
): Recipe {
  const { data, content } = matter(fileContent);
  const frontmatter = data as RecipeFrontmatter;

  // Parse tags (handle both string and array)
  let tags: string[] = [];
  if (Array.isArray(frontmatter.tags)) {
    tags = frontmatter.tags;
  } else if (typeof frontmatter.tags === 'string') {
    tags = frontmatter.tags
      .split(',')
      .map(t => t.trim())
      .filter(Boolean);
  }

  // Generate slug from filename
  const slug = filePath
    .split('/')
    .pop()!
    .replace('.md', '');

  return {
    slug,
    title: frontmatter.title || slug.replace(/-/g, ' '),
    tags,
    content,
    filePath,
  };
}
```

**Typography Styling (from UX Spec):**
- Use Tailwind `prose` plugin for markdown styling
- Apply `prose-zinc` for neutral color scheme
- H1: Recipe title (36px, bold)
- H2: Section headings (24px, semi-bold)
- Body: 16px desktop, 18px mobile
- Lists: Proper indentation and spacing

**Critical Standards:**
- Never use `any` type - define proper Recipe interfaces
- Sanitize markdown content (react-markdown does this by default)
- Handle missing frontmatter gracefully (use filename as title)
- Test edge cases (empty files, malformed YAML, missing tags)

### Testing

**Test Location:**
- `tests/components/recipe/RecipeDisplay.test.tsx` - Component tests
- `tests/services/recipeParser.test.ts` - Parser unit tests

**Testing Framework:**
- Vitest for unit tests
- React Testing Library for component tests

**Testing Standards:**
- Test user-visible output (rendered markdown, not parsing details)
- Mock recipe data for component tests
- Test parser with real markdown strings
- Aim for >80% coverage

**Parser Test Example:**
```typescript
describe('recipeParser', () => {
  it('extracts title and tags from frontmatter', () => {
    const markdown = `---
title: Test Recipe
tags: tag1, tag2, tag3
---
# Content`;

    const result = parseRecipeFile(markdown, 'test-recipe.md');

    expect(result.title).toBe('Test Recipe');
    expect(result.tags).toEqual(['tag1', 'tag2', 'tag3']);
    expect(result.slug).toBe('test-recipe');
  });
});
```

**Component Test Example:**
```typescript
describe('RecipeDisplay', () => {
  it('renders markdown content with headings and lists', () => {
    const recipe: Recipe = {
      slug: 'test',
      title: 'Test Recipe',
      tags: [],
      content: '## Ingredients\n\n- Item 1\n- Item 2',
      filePath: 'test.md',
    };

    render(<RecipeDisplay recipe={recipe} />);

    expect(screen.getByRole('heading', { name: 'Test Recipe' })).toBeInTheDocument();
    expect(screen.getByRole('heading', { name: 'Ingredients' })).toBeInTheDocument();
    expect(screen.getByText('Item 1')).toBeInTheDocument();
  });
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-08 | 1.0 | Initial story creation | John (PM) |
| 2025-12-08 | 1.1 | Story implementation completed | James (Dev) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

None - no issues encountered during implementation

### Completion Notes

- Installed markdown processing libraries: react-markdown, remark, remark-gfm, gray-matter
- Installed @tailwindcss/typography plugin for prose styling
- Updated tailwind.config.js to include typography plugin
- Created TypeScript interfaces in src/types/recipe.ts:
  - Recipe: complete recipe with content
  - RecipeMetadata: recipe without content field
  - RecipeFrontmatter: YAML frontmatter structure
- Implemented recipeParser service with robust parsing:
  - Handles both array and comma-separated string tags
  - Trims whitespace from tags
  - Filters empty tags
  - Fallback to filename for missing title
  - Graceful handling of missing frontmatter
  - Slug generation from file path
- Created RecipeDisplay component:
  - Uses react-markdown with remark-gfm plugin
  - Applies Tailwind typography classes (prose prose-zinc)
  - Max-width 800px for readability
  - Proper heading hierarchy
- Created sample recipe: recipes/chocolate-chip-cookies.md
  - YAML frontmatter with title and comma-separated tags
  - Ingredients section with bullet list
  - Instructions section with numbered list
  - Additional Notes section
  - Follows kebab-case naming convention
- Integrated RecipeDisplay into App.tsx:
  - Imports recipe file as raw text using Vite's ?raw suffix
  - Parses recipe with recipeParser service
  - Displays in main content area
- Comprehensive test coverage:
  - 10 service unit tests for recipeParser (all edge cases)
  - 8 component tests for RecipeDisplay
  - Total: 23 tests passing
- All validations passed: TypeScript, ESLint, tests, production build

Production build: ~423KB JS (125.36KB gzipped), 23.25KB CSS (4.53KB gzipped)
Note: gray-matter eval warning is expected and not a blocker

All acceptance criteria met and validated.

### File List

**Created:**
- `src/types/recipe.ts` - TypeScript interfaces for recipes
- `src/services/recipeParser.ts` - Frontmatter parsing service
- `src/components/recipe/RecipeDisplay.tsx` - Recipe display component
- `recipes/chocolate-chip-cookies.md` - Sample recipe file
- `tests/services/recipeParser.test.ts` - Parser unit tests (10 tests)
- `tests/components/recipe/RecipeDisplay.test.tsx` - Component tests (8 tests)

**Modified:**
- `tailwind.config.js` - Added typography plugin
- `package.json` - Added markdown processing dependencies
- `src/App.tsx` - Integrated RecipeDisplay with sample recipe

## QA Results

_To be populated by QA agent_
