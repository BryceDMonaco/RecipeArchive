# Story 2.3: Real-Time Search Implementation

## Status

Ready for Review

## Story

**As a** user,
**I want** to search for recipes by typing in a search box,
**so that** I can quickly find specific recipes without scrolling through the entire list.

## Acceptance Criteria

1. `fuse.js` library installed and configured
2. Search index created from recipe metadata and content
3. SearchBar component added to top of sidebar using shadcn Input component
4. Search filters recipe list in real-time as user types
5. Search matches across recipe titles, tags, and full content
6. Fuzzy search handles minor typos gracefully
7. Empty search shows all recipes
8. Search with no results displays "No recipes found" message
9. Search is case-insensitive
10. Unit tests verify search algorithm matches expected recipes
11. Component tests verify SearchBar updates recipe list on input

## Tasks / Subtasks

- [x] Install fuse.js library
- [x] Update recipe manifest plugin to include full content
- [x] Update TypeScript types for SearchableRecipeMetadata
- [x] Create SearchBar component with clear button
- [x] Create useRecipeSearch hook with Fuse.js integration
- [x] Integrate SearchBar into App sidebar
- [x] Add recipe count indicator
- [x] Write SearchBar component tests
- [x] Write useRecipeSearch hook tests
- [x] Verify all tests pass (65 total) and build succeeds

## Dev Notes

### Relevant Architecture Information

**Epic Context:**
- Builds on Story 2.1 (Recipe List) and 2.2 (Routing)
- Enables quick recipe discovery in growing collections
- Works alongside Story 2.4 (Tag Filtering) - both filters can be active simultaneously

**Search Strategy:**
- **Library:** fuse.js (lightweight fuzzy search)
- **Index:** Built from recipe metadata + full content
- **Real-time:** Updates on every keystroke (debounced if performance issues)

**Search Index Structure:**
```typescript
interface SearchableRecipe {
  filename: string;
  slug: string;
  title: string;
  tags: string[];
  content: string;  // Full markdown content for deep search
}
```

**Fuse.js Configuration:**
```typescript
const fuseOptions = {
  keys: [
    { name: 'title', weight: 0.5 },      // Title matches weighted highest
    { name: 'tags', weight: 0.3 },       // Tag matches second priority
    { name: 'content', weight: 0.2 }     // Content matches lowest priority
  ],
  threshold: 0.4,        // 0.0 = perfect match, 1.0 = match anything
  ignoreLocation: true,  // Search entire content, not just beginning
  minMatchCharLength: 2  // Require at least 2 characters to match
};
```

**Component Structure:**
```
Sidebar
├── SearchBar (shadcn Input component)
│   ├── Search icon
│   └── Clear button (X) when text present
└── RecipeList (filtered results)
    └── "No recipes found" message (when results.length === 0)
```

**State Management:**
- Search query stored in React state (sidebar component or context)
- Filtered recipe list computed from search results
- Consider debouncing search input (300ms) if performance lags with large collections

**UI/UX Details:**
- Search input placeholder: "Search recipes..."
- Clear button appears when text is entered
- Search box always visible at top of sidebar
- Recipe count indicator: "Showing X of Y recipes"
- Smooth transitions when filtering results

**Performance Considerations:**
- For MVP (< 100 recipes): No optimization needed
- Future: Debounce search input for large collections (500+ recipes)
- Future: Consider web worker for search if blocking UI thread

### Testing

**Test Location:**
- `tests/utils/search.test.ts` - Search algorithm tests
- `tests/components/SearchBar.test.tsx` - Component interaction tests

**Unit Tests:**
- Test search finds recipe by exact title match
- Test search finds recipe by partial title match
- Test search finds recipe by tag
- Test search finds recipe by content keyword
- Test fuzzy search handles typos (e.g., "choclate" finds "chocolate")
- Test empty search returns all recipes
- Test search is case-insensitive
- Test no results scenario

**Component Tests:**
- Test SearchBar renders with placeholder text
- Test typing in SearchBar updates recipe list
- Test clear button appears when text entered
- Test clear button clears search and shows all recipes
- Test "No recipes found" message displays when results empty

**Test Data:**
- Create fixture with 5-10 sample recipes
- Include recipes with overlapping tags/keywords for precise testing
- Test edge cases: special characters, very long search terms

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-09 | 1.0 | Initial story creation from Epic 2 | John (PM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Implementation Summary
- Installed fuse.js for fuzzy search
- Updated recipe manifest plugin to include full markdown content
- Created SearchableRecipeMetadata interface extending RecipeMetadata
- Built SearchBar component with search icon and clear button
- Implemented useRecipeSearch hook with Fuse.js configuration
- Configured Fuse.js: title (50%), tags (30%), content (20%) weighting
- Threshold set to 0.4 for good fuzzy matching
- Integrated search into App with recipe count display
- All 65 tests passing (8 SearchBar + 10 useRecipeSearch + 47 existing)
- Search is real-time, case-insensitive, handles typos

### File List
- `/src/components/search/SearchBar.tsx` (new)
- `/src/hooks/useRecipeSearch.ts` (new)
- `/tests/components/SearchBar.test.tsx` (new)
- `/tests/hooks/useRecipeSearch.test.ts` (new)
- `/vite-plugins/recipe-manifest.ts` (modified - added content extraction)
- `/src/types/recipe.ts` (modified - added SearchableRecipeMetadata)
- `/src/vite-env.d.ts` (modified - updated virtual module declaration)
- `/src/App.tsx` (modified - integrated search functionality)
- `/package.json` (modified - added fuse.js dependency)

### Debug Log References
None

### Completion Notes
- All acceptance criteria met
- Search matches across title, tags, and full content
- Fuzzy search handles typos (e.g., "spagetti" finds "spaghetti")
- Empty search shows all recipes
- "No recipes found" displayed when no results
- Case-insensitive search working
- Recipe count shows "Showing X of Y recipes" when searching
- Clear button (X) appears when text is entered
- Search icon provided by lucide-react

### Change Log
N/A - Implementation changes tracked in main Change Log

## QA Results

_To be populated by QA agent_
