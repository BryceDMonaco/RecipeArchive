# Story 2.4: Tag-Based Filtering

## Status

Ready for Review

## Story

**As a** user,
**I want** to filter recipes by tags,
**so that** I can find recipes by category (e.g., "vegetarian", "dessert", "quick").

## Acceptance Criteria

1. Tag aggregation extracts all unique tags from recipe metadata
2. TagFilter component displays available tags (can use shadcn Badge components)
3. Tags displayed in sidebar above or below search box
4. Clicking a tag filters recipe list to show only recipes with that tag
5. Multiple tags can be selected (AND logic - recipe must have all selected tags)
6. Selected tags visually indicated (highlighted or different color)
7. Clicking selected tag deselects it
8. "Clear filters" button clears all selected tags
9. Tag filtering works in conjunction with search (filters applied to search results)
10. Unit tests verify tag extraction and filtering logic
11. Component tests verify tag selection updates recipe list

## Tasks / Subtasks

- [x] Create TagFilter component with shadcn Badge styling
- [x] Implement tag aggregation from recipe metadata
- [x] Add tag toggle functionality (select/deselect)
- [x] Implement AND logic for multiple tag selection
- [x] Create useRecipeFilter hook combining search and tags
- [x] Integrate TagFilter into App sidebar
- [x] Add "Clear filters" button
- [x] Show AND logic description for selected tags
- [x] Write TagFilter component tests
- [x] Write useRecipeFilter hook tests
- [x] Verify all tests pass (84 total) and build succeeds

## Dev Notes

### Relevant Architecture Information

**Epic Context:**
- Builds on Story 2.1 (Recipe List and Metadata)
- Works alongside Story 2.3 (Search) - both filters active simultaneously
- Completes the recipe discovery experience for Epic 2

**Tag System Design:**
- Tags stored in recipe frontmatter as comma-separated values
- Example: `tags: dessert, baking, quick, vegetarian`
- Tag aggregation extracts all unique tags across all recipes
- Tags displayed alphabetically or by frequency (most common first)

**Filtering Logic:**
- **AND logic:** Recipe must have ALL selected tags to appear in results
- **Combined with search:** Tag filter applied to search results (not all recipes)
- **Priority:** Search filters first → then tag filter → display results

**Component Structure:**
```
Sidebar
├── SearchBar
├── TagFilter
│   ├── TagBadge (one per unique tag)
│   │   └── Click toggles selection
│   └── "Clear filters" button (visible when tags selected)
└── RecipeList (filtered by search + tags)
```

**Tag Display Options:**
```
Option 1: All tags visible (scrollable if needed)
Option 2: Collapsible section "Filter by tags" (expandable)
Option 3: Dropdown/popover (more compact)

Recommendation: Option 1 for MVP (simple, discoverable)
```

**Tag Badge States:**
- **Unselected:** Default shadcn Badge styling (subtle, gray)
- **Selected:** Accent color (primary color, more prominent)
- **Hover:** Slight background change to indicate clickable

**shadcn/ui Components:**
- `Badge` component for tag display
- `Button` component for "Clear filters"
- Optional: `ScrollArea` if many tags

**State Management:**
```typescript
// Selected tags stored in state
const [selectedTags, setSelectedTags] = useState<string[]>([]);

// Toggle tag selection
const toggleTag = (tag: string) => {
  setSelectedTags(prev =>
    prev.includes(tag)
      ? prev.filter(t => t !== tag)  // Remove if selected
      : [...prev, tag]                // Add if not selected
  );
};

// Filter recipes by selected tags (AND logic)
const filteredByTags = recipes.filter(recipe =>
  selectedTags.every(tag => recipe.tags.includes(tag))
);
```

**Tag Aggregation:**
```typescript
// Extract all unique tags from recipes
const allTags = [...new Set(
  recipes.flatMap(recipe => recipe.tags)
)].sort();
```

**UX Details:**
- Tag count badge: Show number of recipes per tag (optional enhancement)
- Tag order: Alphabetical by default, consider frequency-based later
- Selected tags persist during navigation (context/state management)
- Visual separator between SearchBar and TagFilter
- "X recipes shown" counter updates based on filters

### Testing

**Test Location:**
- `tests/utils/tag-filter.test.ts` - Filtering logic tests
- `tests/components/TagFilter.test.tsx` - Component interaction tests

**Unit Tests:**
- Test tag aggregation extracts all unique tags
- Test single tag filter returns correct recipes
- Test multiple tag filter uses AND logic correctly
- Test tag filter combined with search works correctly
- Test empty selected tags shows all recipes
- Test clearing filters resets to all recipes

**Component Tests:**
- Test TagFilter renders all unique tags
- Test clicking tag toggles selected state
- Test selected tags have different styling
- Test clicking selected tag deselects it
- Test "Clear filters" button clears all selections
- Test recipe list updates when tags selected/deselected
- Test tag filter works alongside search

**Test Data:**
- Create recipes with overlapping tags for testing AND logic
- Example: Recipe A (dessert, quick), Recipe B (dessert, vegetarian), Recipe C (quick, vegetarian)
- Selecting "dessert + quick" should show only Recipe A

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-09 | 1.0 | Initial story creation from Epic 2 | John (PM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Implementation Summary
- Created TagFilter component with tag badge buttons
- Implemented tag aggregation: extracts all unique tags and sorts alphabetically
- Built useRecipeFilter hook combining search and tag filtering
- Tag filtering uses AND logic: recipe must have ALL selected tags
- Selected tags highlighted with blue background (bg-blue-500)
- "Clear filters" button appears when tags are selected
- Shows "Showing recipes with X AND Y" description
- Filters work in conjunction with search (search first, then tag filter)
- All 84 tests passing (9 TagFilter + 10 useRecipeFilter + 65 existing)

### File List
- `/src/components/filter/TagFilter.tsx` (new)
- `/src/hooks/useRecipeFilter.ts` (new)
- `/tests/components/TagFilter.test.tsx` (new)
- `/tests/hooks/useRecipeFilter.test.ts` (new)
- `/src/App.tsx` (modified - integrated tag filtering with search)

### Debug Log References
None

### Completion Notes
- All acceptance criteria met
- Tag aggregation working correctly
- Tags displayed in alphabetical order
- Multiple tags can be selected with AND logic
- Selected tags visually indicated with blue styling
- Clicking selected tag deselects it
- "Clear filters" button clears all selected tags
- Tag filtering works alongside search functionality
- Recipe count updates based on combined filters
- shadcn Button component used for clear filters button

### Change Log
N/A - Implementation changes tracked in main Change Log

## QA Results

_To be populated by QA agent_
